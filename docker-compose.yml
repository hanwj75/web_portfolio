services:
  api_server:
    image: hanwj75/myserver1:1
    depends_on:
      - mysql
    environment:
      - PORT=3333
      - HOST=0.0.0.0
      - DB1_HOST=mysql
      - DB1_PORT=3306
      - DB1_USER=root
      - DB1_PASSWORD=1234
      - DB1_NAME=PORTFOLIOS_DB
      - JWT="4e81a03e-adee-4885-a20b-1161979f2f9f"
    ports:
      - "3333:3333"
    networks:
      - apinetwork
    restart: always # 오류 시 자동 재시작 추가
    command: ["sh", "-c", "yarn migrate && node src/app.js"]

  mysql:
    image: mysql:latest
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: PORTFOLIOS_DB
      MYSQL_USER: account
      MYSQL_PASSWORD: 1234

    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - apinetwork

networks:
  apinetwork:

volumes:
  mysql-data:
